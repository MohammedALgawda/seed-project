# نظام حجز بذور البطاطا - اليمن

## نظرة عامة على المشروع
- **الاسم**: نظام حجز بذور البطاطا اليمني
- **الهدف**: منصة إلكترونية شاملة لإدارة حجوزات بذور البطاطا للمزارعين في اليمن
- **الميزات الرئيسية**: حجز البذور، إدارة المزارعين، توزيع الحصص، تتبع الحالة، لوحة تحكم إدارية

## الروابط
- **رابط النظام المباشر**: https://3000-izhowek4kodtcr4hshagz-b32ec7bb.sandbox.novita.ai
- **GitHub**: سيتم ربطه لاحقاً

## معمارية البيانات
- **نماذج البيانات الرئيسية**: 
  - المزارعون اليمنيون (farmers)
  - المحافظات اليمنية مع الحصص (21 محافظة)
  - أصناف البذور المناسبة للمناخ اليمني (seed_varieties)
  - الموزعون اليمنيون مع نسب العمولة (distributors)
  - الحجوزات (reservations)
  - عناصر الحجز (reservation_items)
  - موظفو النظام (staff)

- **خدمات التخزين**: Cloudflare D1 SQLite Database
- **تدفق البيانات**: تسجيل المزارع → اختيار الأصناف → إنشاء الحجز → موافقة إدارية → توزيع

## دليل المستخدم
### للمزارعين:
1. **التسجيل**: إدخال البيانات الشخصية ورقم الهوية اليمني
2. **اختيار المحافظة**: تحديد إحدى المحافظات اليمنية والموزع المحلي
3. **اختيار البذور**: تصفح الأصناف المتوفرة المناسبة للمناخ اليمني وإضافتها للسلة
4. **إتمام الحجز**: تحديد تاريخ التسليم وإتمام الطلب
5. **تتبع الحالة**: متابعة حالة الحجز باستخدام رقم الهوية

### للموظفين الإداريين:
- **دخول الموظفين**: استخدام اسم المستخدم وكلمة المرور (admin / password123)
- **لوحة التحكم الرئيسية**: عرض الإحصائيات والمؤشرات الحيوية
- **إدارة حصص المحافظات**: تعديل وتحديث حصص المحافظات اليمنية
- **تقارير شاملة**: تقارير الاستهلاك والحصص المتبقية لكل محافظة
- **إدارة الموزعين**: تعديل نسب العمولة للموزعين اليمنيين
- **إدارة الحجوزات**: مراجعة وموافقة الطلبات

## النشر
- **المنصة**: Cloudflare Pages
- **الحالة**: ✅ نشط ومُحدث
- **المكدس التقني**: Hono + TypeScript + TailwindCSS + D1 Database
- **آخر تحديث**: 2024-10-12 (تحديث شامل للبيانات اليمنية)

## الميزات المكتملة حالياً
- ✅ واجهة المستخدم الرئيسية (عربية RTL)
- ✅ نظام تسجيل المزارعين اليمنيين مع التحقق
- ✅ عرض الأصناف المتوفرة المناسبة للبيئة اليمنية
- ✅ نظام الحجز الشامل مع السلة
- ✅ إدارة الحصص للمحافظات اليمنية (21 محافظة)
- ✅ نظام الموزعين اليمنيين والعمولات
- ✅ تتبع حالة الحجوزات
- ✅ واجهة تسجيل دخول الموظفين الإداريين
- ✅ لوحة تحكم إدارية شاملة مع 5 أقسام
- ✅ واجهة إدارة الحصص مع تعديل فوري
- ✅ تقارير مفصلة للاستهلاك والحصص المتبقية
- ✅ إدارة عمولات الموزعين
- ✅ قاعدة بيانات D1 مع البيانات اليمنية المحدثة

## مسارات API الوظيفية الحالية
### للمزارعين:
- `GET /api/provinces` - جلب قائمة المحافظات اليمنية مع الحصص
- `GET /api/seed-varieties` - جلب أصناف البذور المتوفرة  
- `GET /api/distributors/:provinceId` - جلب موزعي محافظة معينة
- `POST /api/farmers` - تسجيل مزارع يمني جديد
- `GET /api/farmers/:idNumber` - البحث عن مزارع بالرقم الوطني اليمني
- `POST /api/reservations` - إنشاء حجز جديد
- `GET /api/farmers/:farmerId/reservations` - جلب حجوزات المزارع

### للإدارة (جديد):
- `PUT /api/admin/provinces/:id/quota` - تحديث حصة محافظة
- `GET /api/admin/quotas-report` - تقرير مفصل للحصص
- `GET /api/admin/distributors` - جلب بيانات الموزعين مع الإحصائيات
- `PUT /api/admin/distributors/:id/commission` - تحديث نسبة عمولة موزع
- `GET /api/admin/consumption-stats` - إحصائيات الاستهلاك بالمحافظات

## لوحة التحكم الإدارية
تحتوي على 5 أقسام رئيسية:
1. **لوحة القيادة**: الإحصائيات العامة والنشاط الأخير
2. **إدارة الحصص**: تعديل حصص المحافظات مع منع التقليل عن المستهلك
3. **التقارير**: تقارير شاملة للاستهلاك والحصص المتبقية
4. **الموزعون**: إدارة نسب العمولة للموزعين اليمنيين
5. **الحجوزات**: إدارة ومراجعة طلبات الحجز (قيد التطوير)

## البيانات اليمنية المحدثة
- **21 محافظة يمنية**: من صنعاء إلى سقطرى
- **9 موزعين يمنيين**: موزعين في المحافظات الرئيسية
- **9 مزارعين يمنيين**: بيانات تجريبية لمزارعين من محافظات مختلفة
- **8 أصناف بذور**: محسنة للبيئة اليمنية
- **حصص متدرجة**: من 50 طن (سقطرى) إلى 600 طن (صنعاء)

## الميزات غير المنفذة
- ❌ نظام الدفع الإلكتروني  
- ❌ رسائل SMS للتأكيدات
- ❌ إدارة مفصلة للحجوزات في القسم الإداري
- ❌ نظام التقييمات والمراجعات
- ❌ تتبع GPS للتسليم
- ❌ التكامل مع أنظمة المحاسبة

## الخطوات المقترحة للتطوير
1. **إكمال إدارة الحجوزات**: إضافة إدارة شاملة للحجوزات في القسم الإداري
2. **نظام الإشعارات**: إضافة تنبيهات البريد الإلكتروني والرسائل النصية
3. **تحسين التقارير**: إضافة مخططات بيانية وتصدير PDF
4. **نظام المصادقة**: تحسين نظام تسجيل الدخول مع JWT
5. **تطبيق الجوال**: تطوير تطبيق أندرويد/iOS
6. **API للأطراف الثالثة**: السماح بالتكامل مع أنظمة المزارع الأخرى

## بيانات الدخول للاختبار
- **المزارعين**: استخدام الأرقام الوطنية من البيانات التجريبية (مثل: 85031200145)
- **الموظفين الإداريين**: admin / password123

## متطلبات التشغيل والنشر
```bash
# تثبيت المتطلبات
npm install

# تطبيق قاعدة البيانات المحلية
npm run db:migrate:local
npm run db:seed

# بناء المشروع
npm run build

# تشغيل بيئة التطوير مع PM2
pm2 start ecosystem.config.cjs

# اختبار النظام
curl http://localhost:3000
```

## هيكل المشروع
```
webapp/
├── src/
│   └── index.tsx          # خادم Hono الرئيسي مع APIs الإدارية
├── public/static/
│   ├── app.js            # JavaScript التطبيق مع لوحة التحكم
│   ├── styles.css        # تنسيقات CSS مخصصة
│   └── images/           # صور الأصناف
├── migrations/
│   ├── 0001_initial_schema.sql
│   └── 0002_admin_system.sql
├── seed.sql              # بيانات تجريبية يمنية
├── wrangler.jsonc        # إعدادات Cloudflare
├── ecosystem.config.cjs  # إعدادات PM2
└── package.json          # تبعيات المشروع
```

---

*نظام حجز بذور البطاطا - منصة إلكترونية متطورة لدعم المزارعين اليمنيين*